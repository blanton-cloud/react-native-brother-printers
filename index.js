// main index.js

import { NativeModules, NativeEventEmitter } from "react-native";

const { ReactNativeBrotherPrinters } = NativeModules || {};

export const BRLMQLPrintSettingsLabelSizeDieCutW17H54 = 0;
export const BRLMQLPrintSettingsLabelSizeDieCutW17H87 = 1;
export const BRLMQLPrintSettingsLabelSizeDieCutW23H23 = 2;
export const BRLMQLPrintSettingsLabelSizeDieCutW29H42 = 3;
export const BRLMQLPrintSettingsLabelSizeDieCutW29H90 = 4;
export const BRLMQLPrintSettingsLabelSizeDieCutW38H90 = 5;
export const BRLMQLPrintSettingsLabelSizeDieCutW39H48 = 6;
export const BRLMQLPrintSettingsLabelSizeDieCutW52H29 = 7;
export const BRLMQLPrintSettingsLabelSizeDieCutW62H29 = 8;
export const BRLMQLPrintSettingsLabelSizeDieCutW62H60 = 9;
export const BRLMQLPrintSettingsLabelSizeDieCutW62H75 = 10;
export const BRLMQLPrintSettingsLabelSizeDieCutW62H100 = 11;
export const BRLMQLPrintSettingsLabelSizeDieCutW60H86 = 12;
export const BRLMQLPrintSettingsLabelSizeDieCutW54H29 = 13;
export const BRLMQLPrintSettingsLabelSizeDieCutW102H51 = 14;
export const BRLMQLPrintSettingsLabelSizeDieCutW102H152 = 15;
export const BRLMQLPrintSettingsLabelSizeDieCutW103H164 = 16;
export const BRLMQLPrintSettingsLabelSizeRollW12 = 17;
export const BRLMQLPrintSettingsLabelSizeRollW29 = 18;
export const BRLMQLPrintSettingsLabelSizeRollW38 = 19;
export const BRLMQLPrintSettingsLabelSizeRollW50 = 20;
export const BRLMQLPrintSettingsLabelSizeRollW54 = 21;
export const BRLMQLPrintSettingsLabelSizeRollW62 = 22;
export const BRLMQLPrintSettingsLabelSizeRollW62RB = 23;
export const BRLMQLPrintSettingsLabelSizeRollW102 = 24;
export const BRLMQLPrintSettingsLabelSizeRollW103 = 25;
export const BRLMQLPrintSettingsLabelSizeDTRollW90 = 26;
export const BRLMQLPrintSettingsLabelSizeDTRollW102 = 27;
export const BRLMQLPrintSettingsLabelSizeDTRollW102H51 = 28;
export const BRLMQLPrintSettingsLabelSizeDTRollW102H152 = 29;
export const BRLMQLPrintSettingsLabelSizeRoundW12DIA = 30;
export const BRLMQLPrintSettingsLabelSizeRoundW24DIA = 31;
export const BRLMQLPrintSettingsLabelSizeRoundW58DIA = 32;

export const LabelSize = {
  BRLMQLPrintSettingsLabelSizeDieCutW17H54,
  BRLMQLPrintSettingsLabelSizeDieCutW17H87,
  BRLMQLPrintSettingsLabelSizeDieCutW23H23,
  BRLMQLPrintSettingsLabelSizeDieCutW29H42,
  BRLMQLPrintSettingsLabelSizeDieCutW29H90,
  BRLMQLPrintSettingsLabelSizeDieCutW38H90,
  BRLMQLPrintSettingsLabelSizeDieCutW39H48,
  BRLMQLPrintSettingsLabelSizeDieCutW52H29,
  BRLMQLPrintSettingsLabelSizeDieCutW62H29,
  BRLMQLPrintSettingsLabelSizeDieCutW62H60,
  BRLMQLPrintSettingsLabelSizeDieCutW62H75,
  BRLMQLPrintSettingsLabelSizeDieCutW62H100,
  BRLMQLPrintSettingsLabelSizeDieCutW60H86,
  BRLMQLPrintSettingsLabelSizeDieCutW54H29,
  BRLMQLPrintSettingsLabelSizeDieCutW102H51,
  BRLMQLPrintSettingsLabelSizeDieCutW102H152,
  BRLMQLPrintSettingsLabelSizeDieCutW103H164,
  BRLMQLPrintSettingsLabelSizeRollW12,
  BRLMQLPrintSettingsLabelSizeRollW29,
  BRLMQLPrintSettingsLabelSizeRollW38,
  BRLMQLPrintSettingsLabelSizeRollW50,
  BRLMQLPrintSettingsLabelSizeRollW54,
  BRLMQLPrintSettingsLabelSizeRollW62,
  BRLMQLPrintSettingsLabelSizeRollW62RB,
  BRLMQLPrintSettingsLabelSizeRollW102,
  BRLMQLPrintSettingsLabelSizeRollW103,
  BRLMQLPrintSettingsLabelSizeDTRollW90,
  BRLMQLPrintSettingsLabelSizeDTRollW102,
  BRLMQLPrintSettingsLabelSizeDTRollW102H51,
  BRLMQLPrintSettingsLabelSizeDTRollW102H152,
  BRLMQLPrintSettingsLabelSizeRoundW12DIA,
  BRLMQLPrintSettingsLabelSizeRoundW24DIA,
  BRLMQLPrintSettingsLabelSizeRoundW58DIA,
};

export const LabelNames = [
  "Die Cut 17mm x 54mm", // 0
  "Die Cut 17mm x 87mm", // 1
  "Die Cut 23mm x 23mm", // 2
  "Die Cut 29mm x 42mm", // 3
  "Die Cut 29mm x 90mm", // 4
  "Die Cut 38mm x 90mm", // 5
  "Die Cut 39mm x 48mm", // 6
  "Die Cut 52mm x 29mm", // 7
  "Die Cut 62mm x 29mm", // 8
  "Die Cut 62mm x 100mm", // 9
  "Die Cut 60mm x 86mm", // 10
  "Die Cut 54mm x 29mm", // 11
  "Die Cut 102mm x 51mm", // 12
  "Die Cut 102mm x 152mm", // 13
  "Die Cut 103mm x 164mm", // 14
  "12mm", // 15
  "29mm", // 16
  "38mm", // 17
  "50mm", // 18
  "54mm", // 19
  "62mm", // 20
  "62mm RB", // 21
  "102mm", // 22
  "103mm", // 23
  "DT 90mm", // 24
  "DT 102mm", // 25
  "DT 102mm x 51mm", // 26
  "DT 102mm x 152mm", // 27
];

/**
 * Starts the discovery process for brother printers
 *
 * @param params
 * @param params.V6             If we should searching using IP v6.
 * @param params.printerName    If we should name the printer something specific.
 *
 * @return {Promise<void>}
 */
export async function discoverPrinters(params = {}) {
  return ReactNativeBrotherPrinters?.discoverPrinters(params);
}

/**
 * Checks if a reader is discoverable
 *
 * @param ip
 *
 * @return {Promise<void>}
 */
export async function pingPrinter(ip) {
  return ReactNativeBrotherPrinters?.pingPrinter(ip);
}

/**
 * Prints an image
 *
 * @param device                  Device object
 * @param uri                     URI of image wanting to be printed
 * @param params
 * @param params.autoCut            Boolean if the printer should auto cut the receipt/label
 * @param params.labelSize          Label size that we are printing with
 * @param params.isHighQuality
 * @param params.isHalftoneErrorDiffusion
 *
 * @return {Promise<*>}
 */
export async function printImage(device, uri, params = {}) {
  if (!params.labelSize) {
    return new Error("Label size must be given when printing a label");
  }

  return ReactNativeBrotherPrinters?.printImage(device, uri, params);
}

// export async function printPDF(device, uri, params = {}) {
//   return ReactNativeBrotherPrinters?.printPDF(device, uri, params);
// }

export const discoverBluetoothPrinters = async () => {
  try {
    const printers = await ReactNativeBrotherPrinters.discoverBluetoothPrinters();
    console.log('Discovered printers:', printers);
    return printers;
  } catch (error) {
    console.error('Error discovering printers:', error);
    throw error;
  }
};

export const discoverBLEPrinters = async () => {
  try {
    const printers = await ReactNativeBrotherPrinters.discoverBLEPrinters();
    console.log('Discovered printers:', printers);
    return printers;
  } catch (error) {
    console.error('Error discovering printers:', error);
    throw error;
  }
};

export const connectToBluetoothPrinter = async (serialNumber) => {
  try {
    const result = await ReactNativeBrotherPrinters.connectToBluetoothPrinter(serialNumber);
    console.log('Connected to printer:', result);
    return result;
  } catch (error) {
    console.error('Error connecting to printer:', error);
    throw error;
  }
};

export const printViaBluetooth = async (serialNumber, data) => {
  try {
    const result = await ReactNativeBrotherPrinters.printViaBluetooth(serialNumber, data);
    console.log('Print result:', result);
    return result;
  } catch (error) {
    console.error('Error printing:', error);
    throw error;
  }
};

let listeners;
if (ReactNativeBrotherPrinters) {
  listeners = new NativeEventEmitter(ReactNativeBrotherPrinters);
}

export function registerBrotherListener(key, method) {
  return listeners?.addListener(key, method);
}

/**
 * Retrieves the status of a printer
 *
 * @param device                  Device object
 * @param device.type             Type of the device (e.g., "bluetooth" or "wifi")
 * @param device.serialNumber     Serial number of the device (required for Bluetooth)
 * @param device.ipAddress        IP address of the device (required for WiFi)
 *
 * @return {Promise<Object>}      Printer status object
 */
export async function getPrinterStatus(device) {
  if (!device || !device.type) {
    throw new Error("Device type must be specified");
  }

  return ReactNativeBrotherPrinters?.getPrinterStatus(device);
}
